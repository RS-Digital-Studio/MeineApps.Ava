<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BomberBlast.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:conv="using:BomberBlast.Converters"
             xmlns:ctrl="using:BomberBlast.Controls"
             x:Class="BomberBlast.Views.AchievementsView"
             x:DataType="vm:AchievementsViewModel">

  <!-- Animierter Menü-Hintergrund -->
  <Panel AutomationProperties.AutomationId="Achievements_Root">
    <ctrl:MenuBackgroundCanvas />

    <Grid RowDefinitions="Auto,*">

      <!-- Header -->
      <Border Grid.Row="0"
              Classes="CardElevated"
              Padding="16,12"
              CornerRadius="0,0,12,12">
        <Grid ColumnDefinitions="Auto,*,Auto">
          <!-- Back Button -->
          <Button Classes="Text"
                  AutomationProperties.AutomationId="Achievements_BtnBack"
                  Command="{Binding BackCommand}">
            <mi:MaterialIcon Kind="ArrowLeft" Width="24" Height="24" />
          </Button>

          <!-- Title -->
          <StackPanel Grid.Column="1"
                      Orientation="Horizontal"
                      HorizontalAlignment="Center"
                      Spacing="8">
            <mi:MaterialIcon Kind="Trophy" Width="24" Height="24"
                             Foreground="{DynamicResource AccentBrush}" />
            <TextBlock Text="{Binding TitleText}"
                       AutomationProperties.AutomationId="Achievements_TxtTitle"
                       FontSize="20" FontWeight="Bold"
                       Foreground="{DynamicResource AccentBrush}" />
          </StackPanel>

          <!-- Progress -->
          <TextBlock Grid.Column="2"
                     AutomationProperties.AutomationId="Achievements_TxtProgress"
                     Text="{Binding ProgressText}"
                     FontSize="18" FontWeight="Bold"
                     Foreground="{DynamicResource TextSecondaryBrush}"
                     VerticalAlignment="Center"
                     Margin="0,0,8,0" />
        </Grid>
      </Border>

      <!-- Empty State (keine Achievements geladen) -->
      <StackPanel Grid.Row="1"
                  IsVisible="{Binding !CategoryGroups.Count}"
                  VerticalAlignment="Center"
                  HorizontalAlignment="Center"
                  Spacing="12">
        <mi:MaterialIcon Kind="TrophyBroken" Width="48" Height="48"
                         Foreground="{DynamicResource TextMutedBrush}"
                         HorizontalAlignment="Center" />
        <TextBlock Text="{Binding EmptyStateText, FallbackValue='Noch keine Achievements verfügbar'}"
                   FontSize="15"
                   Foreground="{DynamicResource TextMutedBrush}"
                   HorizontalAlignment="Center" />
      </StackPanel>

      <!-- Achievement List (nach Kategorie gruppiert) -->
      <ScrollViewer Grid.Row="1"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Auto"
                    IsVisible="{Binding CategoryGroups.Count}">
        <ItemsControl AutomationProperties.AutomationId="Achievements_CategoryList"
                      ItemsSource="{Binding CategoryGroups}" Margin="12,8,12,80">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Spacing="12" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="vm:AchievementCategoryGroup">
              <StackPanel Spacing="4">
                <!-- Kategorie-Header -->
                <Border CornerRadius="6" Padding="0" Margin="0,4,0,2"
                        BorderThickness="3,0,0,0">
                  <Border.BorderBrush>
                    <SolidColorBrush Color="{Binding CategoryColor}" />
                  </Border.BorderBrush>
                  <Border.Background>
                    <SolidColorBrush Color="{Binding CategoryColor}" Opacity="0.08" />
                  </Border.Background>
                  <Grid ColumnDefinitions="*,Auto" Margin="12,8">
                    <TextBlock Grid.Column="0"
                               Text="{Binding CategoryName}"
                               FontSize="16" FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimaryBrush}"
                               VerticalAlignment="Center" />
                    <TextBlock Grid.Column="1"
                               Text="{Binding ProgressText}"
                               FontSize="13" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               VerticalAlignment="Center" />
                  </Grid>
                </Border>

                <!-- Achievements in dieser Kategorie -->
                <ItemsControl ItemsSource="{Binding Items}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="vm:AchievementItem">
                      <Border Classes="Card" Margin="0,2"
                              BoxShadow="0 2 8 0 #25000000"
                              Opacity="{Binding IsUnlocked, Converter={x:Static conv:BoolToOpacityConverter.Instance}}">
                        <Grid ColumnDefinitions="52,*,Auto" Margin="8">
                          <!-- SkiaSharp Achievement-Icon mit Background-Circle -->
                          <Border Width="44" Height="44" CornerRadius="22"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center">
                            <Border.Background>
                              <SolidColorBrush Color="#FFFFFF" Opacity="0.06" />
                            </Border.Background>
                            <ctrl:AchievementIconCanvas Width="40" Height="40"
                                    CategoryIndex="{Binding CategoryIndex}"
                                    IsAchievementUnlocked="{Binding IsUnlocked}"
                                    ProgressFraction="{Binding ProgressFraction}"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center" />
                          </Border>

                          <!-- Name + Description + Coin-Belohnung -->
                          <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="8,0">
                            <TextBlock Text="{Binding Name}"
                                       FontSize="15" FontWeight="Bold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" />
                            <TextBlock Text="{Binding Description}"
                                       FontSize="12"
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       TextWrapping="Wrap" />
                            <!-- Coin-Belohnung mit goldenem Badge -->
                            <Border IsVisible="{Binding HasCoinReward}"
                                    CornerRadius="4" Padding="6,2" Margin="0,2,0,0"
                                    HorizontalAlignment="Left">
                              <Border.Background>
                                <SolidColorBrush Color="#FFD700" Opacity="0.15" />
                              </Border.Background>
                              <TextBlock Text="{Binding CoinRewardText}"
                                         FontSize="11" FontWeight="Bold"
                                         Foreground="#FFD700" />
                            </Border>
                          </StackPanel>

                          <!-- Progress -->
                          <TextBlock Grid.Column="2"
                                     Text="{Binding ProgressText}"
                                     FontSize="14" FontWeight="Bold"
                                     Foreground="{DynamicResource AccentBrush}"
                                     VerticalAlignment="Center" />
                        </Grid>
                      </Border>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </StackPanel>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>

    </Grid>
  </Panel>

</UserControl>
