<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BomberBlast.ViewModels"
             xmlns:conv="using:BomberBlast.Converters"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:controls="using:BomberBlast.Controls"
             xmlns:skia="using:Avalonia.Labs.Controls"
             x:Class="BomberBlast.Views.DeckView"
             x:DataType="vm:DeckViewModel"
             x:Name="Deck_Root">

  <!-- Deck-Builder: Premium Landscape 2-Spalten Layout -->
  <Panel AutomationProperties.AutomationId="Deck_Root">
    <controls:MenuBackgroundCanvas />

    <Grid ColumnDefinitions="1.5*,*" Margin="16,12,16,80">

      <!-- ═══════════════════════════════════════════════════════════
           LINKE SPALTE (*) - Karten-Sammlung
           ═══════════════════════════════════════════════════════════ -->
      <Grid Grid.Column="0" RowDefinitions="Auto,Auto,*" Margin="0,0,12,0">

        <!-- Header: Zurück + Titel + Coins -->
        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" Margin="0,0,0,10">
          <Button Grid.Column="0" Classes="Secondary GameButton"
                  Command="{Binding GoBackCommand}"
                  Width="44" Height="44"
                  Padding="0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                  AutomationProperties.AutomationId="Deck_BtnBack">
            <mi:MaterialIcon Kind="ArrowLeft" Width="22" Height="22"
                             Foreground="{DynamicResource TextPrimaryBrush}" />
          </Button>
          <TextBlock Grid.Column="1"
                     Text="{Binding TitleText}"
                     FontSize="22" FontWeight="Bold"
                     Foreground="{DynamicResource AccentBrush}"
                     HorizontalAlignment="Center" VerticalAlignment="Center"
                     AutomationProperties.AutomationId="Deck_TxtTitle" />

          <!-- Coin + Gem Badges -->
          <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="6">
            <Border Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="16" Padding="12,6"
                    AutomationProperties.AutomationId="Deck_CoinBadge">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="CircleMultiple" Width="18" Height="18" Foreground="#FFD700" />
                <TextBlock Text="{Binding CoinsText}"
                           FontSize="14" FontWeight="SemiBold" Foreground="#FFD700"
                           VerticalAlignment="Center" />
              </StackPanel>
            </Border>
            <Border Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="16" Padding="12,6"
                    BorderBrush="#40FFD700" BorderThickness="1"
                    BoxShadow="0 2 8 0 #25000000"
                    AutomationProperties.AutomationId="Deck_GemBadge">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="DiamondStone" Width="18" Height="18" Foreground="#00BCD4" />
                <TextBlock Text="{Binding GemsText}"
                           FontSize="14" FontWeight="SemiBold" Foreground="#00BCD4"
                           VerticalAlignment="Center" />
              </StackPanel>
            </Border>
          </StackPanel>
        </Grid>

        <!-- Sammlungs-Fortschritt -->
        <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}"
                CornerRadius="10" Padding="12,6" Margin="0,0,0,10"
                BoxShadow="0 2 8 0 #25000000">
          <Grid ColumnDefinitions="Auto,*,Auto">
            <mi:MaterialIcon Grid.Column="0" Kind="CardsPlaying" Width="18" Height="18"
                             Foreground="#1565C0" Margin="0,0,8,0" VerticalAlignment="Center" />
            <ProgressBar Grid.Column="1"
                         Value="{Binding CollectionProgressPercent}" Maximum="100"
                         Foreground="#1565C0" Height="14" CornerRadius="7"
                         VerticalAlignment="Center" Margin="0,0,8,0" />
            <TextBlock Grid.Column="2"
                       Text="{Binding CollectionProgressText}"
                       FontSize="14" FontWeight="Bold"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       VerticalAlignment="Center" />
          </Grid>
        </Border>

        <!-- Karten-Grid -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
          <ItemsControl ItemsSource="{Binding CollectionCards}" Margin="0,0,0,8"
                        AutomationProperties.AutomationId="Deck_CardGrid">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <WrapPanel Orientation="Horizontal" />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="vm:CardDisplayItem">
                <Button Classes="Text" Padding="0" Margin="3"
                        Width="155" Height="240">
                  <Button.Command>
                    <Binding Path="DataContext.SelectCardCommand" ElementName="Deck_Root" />
                  </Button.Command>
                  <Button.CommandParameter>
                    <Binding />
                  </Button.CommandParameter>
                  <!-- Karten-Tile: Groß mit Raritäts-Border (auch bei gesperrten) -->
                  <Border CornerRadius="14" Padding="0"
                          ClipToBounds="True"
                          BoxShadow="0 3 12 0 #35000000">
                    <Border.BorderBrush>
                      <SolidColorBrush Color="{Binding RarityColorHex}"
                                       Opacity="{Binding RarityBorderOpacity}" />
                    </Border.BorderBrush>
                    <Border.BorderThickness>3</Border.BorderThickness>
                    <Panel>
                      <!-- Basis-Hintergrund mit Raritäts-Tönung -->
                      <Border CornerRadius="11">
                        <Border.Background>
                          <LinearGradientBrush StartPoint="0%,0%" EndPoint="0%,100%">
                            <GradientStop Color="#30FFFFFF" Offset="0" />
                            <GradientStop Color="#12FFFFFF" Offset="0.4" />
                            <GradientStop Color="#25000000" Offset="1" />
                          </LinearGradientBrush>
                        </Border.Background>
                      </Border>

                      <!-- Raritäts-Schimmer-Overlay (subtiler Farbverlauf) -->
                      <Border CornerRadius="11" Opacity="{Binding RarityShimmerOpacity}">
                        <Border.Background>
                          <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                            <GradientStop Color="{Binding RarityGlowHex}" Offset="0" />
                            <GradientStop Color="Transparent" Offset="0.6" />
                          </LinearGradientBrush>
                        </Border.Background>
                      </Border>

                      <Grid RowDefinitions="Auto,*,Auto,Auto" Margin="8">

                        <!-- Oben: Rarität-Badge + Status-Badges -->
                        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" Margin="0,2,0,0">
                          <!-- Raritäts-Indikator -->
                          <Border Grid.Column="0" CornerRadius="6" Padding="6,3">
                            <Border.Background>
                              <SolidColorBrush Color="{Binding RarityColorHex}" Opacity="0.2" />
                            </Border.Background>
                            <Ellipse Width="9" Height="9">
                              <Ellipse.Fill>
                                <SolidColorBrush Color="{Binding RarityColorHex}" />
                              </Ellipse.Fill>
                            </Ellipse>
                          </Border>

                          <!-- Upgrade-Badge -->
                          <Border Grid.Column="2" CornerRadius="6" Padding="5,3"
                                  IsVisible="{Binding ShowUpgradeBadge}">
                            <Border.Background>
                              <SolidColorBrush Color="#4CAF50" Opacity="0.85" />
                            </Border.Background>
                            <mi:MaterialIcon Kind="ArrowUpBold" Width="12" Height="12"
                                             Foreground="White" />
                          </Border>

                          <!-- Equipped-Badge -->
                          <Border Grid.Column="2" CornerRadius="6" Padding="5,3"
                                  IsVisible="{Binding ShowEquippedBadge}">
                            <Border.Background>
                              <SolidColorBrush Color="#2196F3" Opacity="0.85" />
                            </Border.Background>
                            <mi:MaterialIcon Kind="Check" Width="12" Height="12"
                                             Foreground="White" />
                          </Border>
                        </Grid>

                        <!-- Mitte: GROSSES Bomben-Icon (SkiaSharp) - zentriert -->
                        <Panel Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center">
                          <!-- Gesperrte Karte: Bomben-Silhouette (gedimmt) + Lock -->
                          <Panel IsVisible="{Binding !IsOwned}">
                            <skia:SKCanvasView Width="130" Height="130" Opacity="0.4"
                                               Tag="{Binding}" PaintSurface="OnDeckCardPaint" />
                            <mi:MaterialIcon Kind="LockOutline" Width="36" Height="36"
                                             Foreground="{DynamicResource TextMutedBrush}"
                                             Opacity="0.6"
                                             HorizontalAlignment="Center" VerticalAlignment="Center" />
                          </Panel>
                          <!-- Freigeschaltete Karte: Großes SkiaSharp Bomben-Icon -->
                          <skia:SKCanvasView Width="130" Height="130"
                                             IsVisible="{Binding IsOwned}"
                                             Tag="{Binding}" PaintSurface="OnDeckCardPaint" />
                        </Panel>

                        <!-- Name -->
                        <TextBlock Grid.Row="2"
                                   Text="{Binding Name}"
                                   FontSize="13" FontWeight="Bold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   TextTrimming="CharacterEllipsis"
                                   TextAlignment="Center" MaxLines="1"
                                   HorizontalAlignment="Center" Margin="0,4,0,0"
                                   Opacity="{Binding NameOpacity}" />

                        <!-- Unten: Level-Anzeige + Count (nur bei besessenen) -->
                        <Grid Grid.Row="3" ColumnDefinitions="*,*" Margin="0,3,0,2"
                              IsVisible="{Binding IsOwned}">
                          <Border Grid.Column="0" CornerRadius="5" Padding="5,2"
                                  HorizontalAlignment="Left">
                            <Border.Background>
                              <SolidColorBrush Color="{Binding LevelColorHex}" Opacity="0.2" />
                            </Border.Background>
                            <TextBlock Text="{Binding LevelLabel}"
                                       FontSize="12" FontWeight="Bold">
                              <TextBlock.Foreground>
                                <SolidColorBrush Color="{Binding LevelColorHex}" />
                              </TextBlock.Foreground>
                            </TextBlock>
                          </Border>
                          <TextBlock Grid.Column="1"
                                     FontSize="11" FontWeight="SemiBold"
                                     Foreground="{DynamicResource TextMutedBrush}"
                                     HorizontalAlignment="Right"
                                     VerticalAlignment="Center">
                            <TextBlock.Text>
                              <MultiBinding StringFormat="x{0}">
                                <Binding Path="Count" />
                              </MultiBinding>
                            </TextBlock.Text>
                          </TextBlock>
                        </Grid>

                        <!-- Raritäts-Label für gesperrte Karten -->
                        <TextBlock Grid.Row="3"
                                   IsVisible="{Binding !IsOwned}"
                                   Text="{Binding RarityLabel}"
                                   FontSize="10" FontWeight="SemiBold"
                                   TextAlignment="Center"
                                   HorizontalAlignment="Center"
                                   Margin="0,3,0,2">
                          <TextBlock.Foreground>
                            <SolidColorBrush Color="{Binding RarityColorHex}" Opacity="0.6" />
                          </TextBlock.Foreground>
                        </TextBlock>
                      </Grid>
                    </Panel>
                  </Border>
                </Button>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>
      </Grid>

      <!-- ═══════════════════════════════════════════════════════════
           RECHTE SPALTE (260px) - Deck-Slots + Detail
           ═══════════════════════════════════════════════════════════ -->
      <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
        <StackPanel Spacing="10" Margin="0,0,0,8">

          <!-- ── Deck-Slots ── -->
          <Border CornerRadius="12" Padding="12,10"
                  BoxShadow="0 2 8 0 #25000000">
            <Border.Background>
              <LinearGradientBrush StartPoint="0%,0%" EndPoint="0%,100%">
                <GradientStop Color="#15003064" Offset="0" />
                <GradientStop Color="{DynamicResource SurfaceColor}" Offset="1" />
              </LinearGradientBrush>
            </Border.Background>
            <StackPanel Spacing="8">
              <!-- Deck-Header -->
              <Grid ColumnDefinitions="Auto,*,Auto">
                <mi:MaterialIcon Grid.Column="0" Kind="CardsPlaying" Width="20" Height="20"
                                 Foreground="{DynamicResource AccentBrush}" />
                <TextBlock Grid.Column="1"
                           Text="{Binding DeckLabel}"
                           FontSize="15" FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           Margin="8,0,0,0" VerticalAlignment="Center" />
                <TextBlock Grid.Column="2"
                           Text="{Binding DeckCountText}"
                           FontSize="13"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center" />
              </Grid>

              <!-- Deck-Slots -->
              <ItemsControl ItemsSource="{Binding DeckSlots}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate x:DataType="vm:DeckSlotItem">
                    <Border CornerRadius="8" Padding="8,6" Margin="0,2">
                      <Border.Background>
                        <SolidColorBrush Color="#FFFFFF" Opacity="0.05" />
                      </Border.Background>
                      <Grid ColumnDefinitions="Auto,Auto,*,Auto">
                        <!-- Slot-Nummer -->
                        <Border Grid.Column="0" CornerRadius="4" Padding="5,2"
                                Margin="0,0,8,0" VerticalAlignment="Center">
                          <Border.Background>
                            <SolidColorBrush Color="#FFFFFF" Opacity="0.08" />
                          </Border.Background>
                          <TextBlock Text="{Binding SlotNumber}"
                                     FontSize="12" FontWeight="Bold"
                                     Foreground="{DynamicResource TextSecondaryBrush}" />
                        </Border>

                        <!-- Icon (wenn belegt) - SkiaSharp Bomben-Icon -->
                        <skia:SKCanvasView Grid.Column="1"
                                           Width="22" Height="22"
                                           IsVisible="{Binding !IsEmpty}"
                                           Margin="0,0,6,0" VerticalAlignment="Center"
                                           Tag="{Binding}" PaintSurface="OnDeckSlotPaint" />

                        <!-- Karten-Info oder "Leer" -->
                        <StackPanel Grid.Column="2" VerticalAlignment="Center">
                          <TextBlock Text="{Binding Name}"
                                     IsVisible="{Binding !IsEmpty}"
                                     FontSize="13" FontWeight="SemiBold"
                                     Foreground="{DynamicResource TextPrimaryBrush}"
                                     TextTrimming="CharacterEllipsis" />
                          <TextBlock IsVisible="{Binding !IsEmpty}"
                                     Text="{Binding UsesText}"
                                     FontSize="10"
                                     Foreground="{DynamicResource TextSecondaryBrush}" />
                          <TextBlock Text="---"
                                     IsVisible="{Binding IsEmpty}"
                                     FontSize="13"
                                     Foreground="{DynamicResource TextMutedBrush}" />
                        </StackPanel>

                        <!-- Entfernen-Button -->
                        <Button Grid.Column="3" Classes="Text"
                                IsVisible="{Binding !IsEmpty}"
                                Command="{Binding #Deck_Root.DataContext.UnequipSlotCommand}"
                                CommandParameter="{Binding SlotIndex}"
                                Padding="4">
                          <mi:MaterialIcon Kind="Close" Width="14" Height="14"
                                           Foreground="{DynamicResource TextMutedBrush}" />
                        </Button>
                      </Grid>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>

              <!-- Slot #5 Freischalten-Button (nur wenn nicht freigeschaltet) -->
              <Panel MinHeight="36" Margin="0,4,0,0"
                     IsVisible="{Binding !IsSlot5Unlocked}">
                <controls:GameButtonCanvas ButtonColor="#00BCD4" DamageLevel="0.4" ButtonSeed="140" />
                <Button Classes="GameButton" HorizontalAlignment="Stretch"
                        IsEnabled="{Binding CanUnlockSlot5}"
                        Command="{Binding UnlockSlot5Command}"
                        Background="Transparent"
                        Foreground="White"
                        Height="36">
                  <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                    <mi:MaterialIcon Kind="LockOpenVariant" Width="16" Height="16" Foreground="White" />
                    <TextBlock Text="{Binding UnlockSlot5Text}"
                               FontSize="12" FontWeight="SemiBold" Foreground="White" />
                  </StackPanel>
                </Button>
              </Panel>
            </StackPanel>
          </Border>

          <!-- ── Karten-Detail ── -->
          <Border Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="12" Padding="12,10"
                  BorderBrush="{DynamicResource AccentBrush}"
                  BorderThickness="0,3,0,0"
                  BoxShadow="0 2 8 0 #25000000"
                  IsVisible="{Binding HasSelectedCard}">
            <StackPanel Spacing="8">

              <!-- Name + Schließen-Button -->
              <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- SkiaSharp Bomben-Icon (größer für Detail-Ansicht) -->
                <skia:SKCanvasView Grid.Column="0"
                                   x:Name="DetailBombCanvas"
                                   Width="36" Height="36" Margin="0,0,8,0"
                                   IsVisible="{Binding HasSelectedCard}"
                                   PaintSurface="OnDeckDetailPaint" />
                <!-- Name -->
                <TextBlock Grid.Column="1"
                           Text="{Binding SelectedCardName}"
                           FontSize="18" FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           VerticalAlignment="Center" />
                <!-- Schließen -->
                <Button Grid.Column="2" Classes="Text" Padding="4"
                        Command="{Binding CloseDetailCommand}">
                  <mi:MaterialIcon Kind="Close" Width="18" Height="18"
                                   Foreground="{DynamicResource TextMutedBrush}" />
                </Button>
              </Grid>

              <!-- Rarität -->
              <Border CornerRadius="6" Padding="8,3" HorizontalAlignment="Left">
                <Border.Background>
                  <SolidColorBrush Color="{Binding SelectedCardRarityColor}" Opacity="0.15" />
                </Border.Background>
                <TextBlock Text="{Binding SelectedCardRarityText}"
                           FontSize="11" FontWeight="Bold">
                  <TextBlock.Foreground>
                    <SolidColorBrush Color="{Binding SelectedCardRarityColor}" />
                  </TextBlock.Foreground>
                </TextBlock>
              </Border>

              <!-- Beschreibung -->
              <TextBlock Text="{Binding SelectedCardDescription}"
                         FontSize="11"
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         TextWrapping="Wrap" MaxLines="3" />

              <!-- Separator -->
              <Border Height="1" Opacity="0.15">
                <Border.Background>
                  <SolidColorBrush Color="{DynamicResource TextSecondaryColor}" />
                </Border.Background>
              </Border>

              <!-- ── Besessene Karte: Stats ── -->
              <StackPanel Spacing="6" IsVisible="{Binding IsSelectedCardOwned}">

                <!-- Level + Stärke -->
                <Grid ColumnDefinitions="*,*">
                  <StackPanel Grid.Column="0" Spacing="2">
                    <TextBlock Text="Level"
                               FontSize="10" Foreground="{DynamicResource TextMutedBrush}" />
                    <TextBlock Text="{Binding SelectedCardLevelText}"
                               FontSize="12" FontWeight="SemiBold" Foreground="#FFD700" />
                  </StackPanel>
                  <StackPanel Grid.Column="1" Spacing="2">
                    <TextBlock Text="{Binding StrengthLabel}"
                               FontSize="10" Foreground="{DynamicResource TextMutedBrush}" />
                    <TextBlock Text="{Binding SelectedCardStrengthText}"
                               FontSize="12" FontWeight="SemiBold" Foreground="#4CAF50" />
                  </StackPanel>
                </Grid>

                <!-- Einsätze -->
                <TextBlock Text="{Binding SelectedCardUsesText}"
                           FontSize="11"
                           Foreground="{DynamicResource TextSecondaryBrush}" />

                <!-- Upgrade-Sektion -->
                <Border CornerRadius="8" Padding="8,6"
                        IsVisible="{Binding ShowUpgradeProgress}">
                  <Border.Background>
                    <SolidColorBrush Color="#FFFFFF" Opacity="0.04" />
                  </Border.Background>
                  <StackPanel Spacing="4">
                    <TextBlock Text="{Binding UpgradeLabel}"
                               FontSize="10" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextMutedBrush}" />
                    <ProgressBar Value="{Binding UpgradeProgressPercent}" Maximum="100"
                                 Foreground="#4CAF50" Height="12" CornerRadius="6" />
                    <TextBlock Text="{Binding SelectedCardUpgradeText}"
                               FontSize="11"
                               Foreground="{DynamicResource TextSecondaryBrush}" />

                    <!-- Upgrade-Benefit: Was bringt das nächste Level? -->
                    <Border CornerRadius="5" Padding="6,3" Margin="0,2,0,0"
                            IsVisible="{Binding ShowUpgradeProgress}">
                      <Border.Background>
                        <SolidColorBrush Color="#FFD700" Opacity="0.08" />
                      </Border.Background>
                      <StackPanel Orientation="Horizontal" Spacing="5">
                        <mi:MaterialIcon Kind="ArrowUpBold" Width="12" Height="12"
                                         Foreground="#FFD700" VerticalAlignment="Center" />
                        <TextBlock Text="{Binding SelectedCardUpgradeBenefitText}"
                                   FontSize="10" FontWeight="SemiBold"
                                   Foreground="#FFD700" VerticalAlignment="Center" />
                      </StackPanel>
                    </Border>
                  </StackPanel>
                </Border>

                <!-- Equip-Buttons (4 Basis + optionaler 5. Slot) -->
                <Grid ColumnDefinitions="*,*,*,*,*" Margin="0,2,0,0">
                  <Button Grid.Column="0" Classes="GameButton" Padding="0" Height="30" Margin="0,0,3,0"
                          Command="{Binding EquipToSlotCommand}" CommandParameter="0"
                          HorizontalContentAlignment="Center">
                    <TextBlock Text="#1" FontSize="11" FontWeight="Bold" />
                  </Button>
                  <Button Grid.Column="1" Classes="GameButton" Padding="0" Height="30" Margin="0,0,3,0"
                          Command="{Binding EquipToSlotCommand}" CommandParameter="1"
                          HorizontalContentAlignment="Center">
                    <TextBlock Text="#2" FontSize="11" FontWeight="Bold" />
                  </Button>
                  <Button Grid.Column="2" Classes="GameButton" Padding="0" Height="30" Margin="0,0,3,0"
                          Command="{Binding EquipToSlotCommand}" CommandParameter="2"
                          HorizontalContentAlignment="Center">
                    <TextBlock Text="#3" FontSize="11" FontWeight="Bold" />
                  </Button>
                  <Button Grid.Column="3" Classes="GameButton" Padding="0" Height="30" Margin="0,0,3,0"
                          Command="{Binding EquipToSlotCommand}" CommandParameter="3"
                          HorizontalContentAlignment="Center">
                    <TextBlock Text="#4" FontSize="11" FontWeight="Bold" />
                  </Button>
                  <Button Grid.Column="4" Classes="GameButton" Padding="0" Height="30"
                          IsVisible="{Binding IsSlot5Unlocked}"
                          Command="{Binding EquipToSlotCommand}" CommandParameter="4"
                          HorizontalContentAlignment="Center">
                    <TextBlock Text="#5" FontSize="11" FontWeight="Bold" Foreground="#00BCD4" />
                  </Button>
                </Grid>

                <!-- Upgrade-Button -->
                <Panel MinHeight="34" Margin="0,2,0,0">
                  <controls:GameButtonCanvas ButtonColor="#4CAF50" DamageLevel="0.5" ButtonSeed="141" />
                  <Button Classes="GameButton" HorizontalAlignment="Stretch"
                          IsEnabled="{Binding CanUpgradeSelected}"
                          Command="{Binding UpgradeCardCommand}"
                          Background="Transparent"
                          Foreground="White"
                          Height="34">
                    <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                      <mi:MaterialIcon Kind="ArrowUpBold" Width="16" Height="16" Foreground="White" />
                      <TextBlock Text="{Binding SelectedCardUpgradeText}"
                                 FontSize="12" FontWeight="SemiBold" Foreground="White" />
                    </StackPanel>
                  </Button>
                </Panel>
              </StackPanel>

              <!-- ── Nicht besessene Karte: Info ── -->
              <StackPanel Spacing="6" IsVisible="{Binding !IsSelectedCardOwned}">
                <Border CornerRadius="8" Padding="10,8">
                  <Border.Background>
                    <SolidColorBrush Color="#F44336" Opacity="0.1" />
                  </Border.Background>
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <mi:MaterialIcon Kind="Lock" Width="18" Height="18"
                                     Foreground="#F44336" VerticalAlignment="Center" />
                    <TextBlock Text="{Binding NotOwnedText}"
                               FontSize="12" FontWeight="SemiBold"
                               Foreground="#F44336" VerticalAlignment="Center" />
                  </StackPanel>
                </Border>

                <!-- Basis-Einsätze -->
                <TextBlock Text="{Binding SelectedCardUsesText}"
                           FontSize="11"
                           Foreground="{DynamicResource TextSecondaryBrush}" />
              </StackPanel>

              <!-- ── Fundorte (immer sichtbar) ── -->
              <Border CornerRadius="8" Padding="8,6" Margin="0,2,0,0">
                <Border.Background>
                  <SolidColorBrush Color="#FFFFFF" Opacity="0.04" />
                </Border.Background>
                <StackPanel Spacing="3">
                  <StackPanel Orientation="Horizontal" Spacing="6">
                    <mi:MaterialIcon Kind="MapMarker" Width="14" Height="14"
                                     Foreground="{DynamicResource AccentBrush}" />
                    <TextBlock Text="{Binding DropSourceLabel}"
                               FontSize="10" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextMutedBrush}" />
                  </StackPanel>
                  <TextBlock Text="{Binding SelectedCardDropSourceText}"
                             FontSize="11"
                             Foreground="{DynamicResource TextSecondaryBrush}"
                             TextWrapping="Wrap" />
                </StackPanel>
              </Border>
            </StackPanel>
          </Border>

          <!-- ── Platzhalter wenn nichts ausgewählt ── -->
          <Border Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="12" Padding="16"
                  IsVisible="{Binding !HasSelectedCard}">
            <StackPanel Spacing="8" HorizontalAlignment="Center" VerticalAlignment="Center">
              <mi:MaterialIcon Kind="CardsPlayingOutline" Width="40" Height="40"
                               Foreground="{DynamicResource TextMutedBrush}"
                               HorizontalAlignment="Center" />
              <TextBlock Text="{Binding SelectCardHintText}"
                         FontSize="13"
                         Foreground="{DynamicResource TextMutedBrush}"
                         HorizontalAlignment="Center"
                         FontStyle="Italic" TextAlignment="Center" />
            </StackPanel>
          </Border>

        </StackPanel>
      </ScrollViewer>
    </Grid>
  </Panel>

</UserControl>
