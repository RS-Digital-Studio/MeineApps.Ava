<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BomberBlast.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             xmlns:ctrl="using:BomberBlast.Controls"
             x:Class="BomberBlast.Views.GameOverView"
             x:DataType="vm:GameOverViewModel">

  <!-- Gradient Background -->
  <Panel AutomationProperties.AutomationId="GameOver_Root">
    <Border>
      <Border.Background>
        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
          <GradientStop Color="{DynamicResource GradientStartColor}" Offset="0" />
          <GradientStop Color="{DynamicResource GradientMidColor}" Offset="0.5" />
          <GradientStop Color="{DynamicResource GradientEndColor}" Offset="1" />
        </LinearGradientBrush>
      </Border.Background>
    </Border>

    <Grid RowDefinitions="*">

      <!-- 2-Column Layout: Score+Coins links, Buttons rechts -->
      <!-- SlideUp Entry-Animation -->
      <Grid Grid.Row="0"
            ColumnDefinitions="*,*"
            VerticalAlignment="Center"
            Margin="24,16,24,80"
            RenderTransformOrigin="0.5,0.5">
        <Grid.RenderTransform>
          <TranslateTransform Y="0" />
        </Grid.RenderTransform>
        <Grid.Styles>
          <Style Selector="Grid">
            <Style.Animations>
              <Animation Duration="0:0:0.2" Easing="CubicEaseOut" FillMode="Forward">
                <KeyFrame Cue="0%">
                  <Setter Property="Opacity" Value="0" />
                  <Setter Property="TranslateTransform.Y" Value="20" />
                </KeyFrame>
                <KeyFrame Cue="100%">
                  <Setter Property="Opacity" Value="1" />
                  <Setter Property="TranslateTransform.Y" Value="0" />
                </KeyFrame>
              </Animation>
            </Style.Animations>
          </Style>
        </Grid.Styles>

        <!-- Links: Score + Coins Info (ScrollViewer für Overflow-Schutz) -->
        <ScrollViewer Grid.Column="0"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
        <StackPanel VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Spacing="12">

          <TextBlock AutomationProperties.AutomationId="GameOver_TxtGameOver"
                     Text="{loc:Translate GameOver}"
                     FontSize="42"
                     FontWeight="Bold"
                     Foreground="{DynamicResource ErrorBrush}"
                     HorizontalAlignment="Center"
                     IsVisible="{Binding !IsLevelComplete}" />
          <TextBlock AutomationProperties.AutomationId="GameOver_TxtLevelComplete"
                     Text="{loc:Translate LevelComplete}"
                     FontSize="42"
                     FontWeight="Bold"
                     Foreground="{DynamicResource SuccessBrush}"
                     HorizontalAlignment="Center"
                     IsVisible="{Binding IsLevelComplete}" />

          <!-- Motivationstext (kontextbezogen, nur bei Game Over) -->
          <TextBlock AutomationProperties.AutomationId="GameOver_TxtMotivation"
                     Text="{Binding MotivationText}"
                     FontSize="14"
                     FontWeight="SemiBold"
                     Foreground="{DynamicResource TextSecondaryBrush}"
                     HorizontalAlignment="Center"
                     IsVisible="{Binding HasMotivation}" />

          <StackPanel Spacing="6">
            <TextBlock AutomationProperties.AutomationId="GameOver_TxtScore"
                       Text="{Binding ScoreText}"
                       FontSize="28"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       HorizontalAlignment="Center" />
            <TextBlock AutomationProperties.AutomationId="GameOver_TxtLevel"
                       Text="{Binding LevelText}"
                       FontSize="18"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center" />

            <!-- Survival-Statistiken -->
            <Border AutomationProperties.AutomationId="GameOver_SurvivalStats"
                    IsVisible="{Binding HasSurvivalStats}"
                    Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="8"
                    Padding="12,6"
                    HorizontalAlignment="Center">
              <StackPanel Orientation="Horizontal" Spacing="16">
                <StackPanel Spacing="2" HorizontalAlignment="Center">
                  <TextBlock Text="{loc:Translate SurvivalKillsLabel}"
                             FontSize="11"
                             Foreground="{DynamicResource TextMutedBrush}"
                             HorizontalAlignment="Center" />
                  <StackPanel Orientation="Horizontal" Spacing="4"
                              HorizontalAlignment="Center">
                    <mi:MaterialIcon Kind="Skull" Width="16" Height="16"
                                     Foreground="#FF4444" />
                    <TextBlock Text="{Binding SurvivalKills}"
                               FontSize="20" FontWeight="Bold"
                               Foreground="#FF4444" />
                  </StackPanel>
                </StackPanel>
                <StackPanel Spacing="2" HorizontalAlignment="Center">
                  <TextBlock Text="{loc:Translate SurvivalTimeLabel}"
                             FontSize="11"
                             Foreground="{DynamicResource TextMutedBrush}"
                             HorizontalAlignment="Center" />
                  <StackPanel Orientation="Horizontal" Spacing="4"
                              HorizontalAlignment="Center">
                    <mi:MaterialIcon Kind="Timer" Width="16" Height="16"
                                     Foreground="{DynamicResource SecondaryBrush}" />
                    <TextBlock Text="{Binding SurvivalTimeText}"
                               FontSize="20" FontWeight="Bold"
                               Foreground="{DynamicResource SecondaryBrush}" />
                  </StackPanel>
                </StackPanel>
              </StackPanel>
            </Border>
          </StackPanel>

          <!-- High Score Badge -->
          <Border AutomationProperties.AutomationId="GameOver_HighScoreBadge"
                  Background="{DynamicResource AccentBrush}"
                  CornerRadius="10"
                  Padding="12,6"
                  IsVisible="{Binding IsHighScore}"
                  HorizontalAlignment="Center">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="Star" Width="20" Height="20"
                               Foreground="{DynamicResource SurfaceBrush}" />
              <TextBlock Text="{loc:Translate NewHighScore}"
                         FontSize="16"
                         FontWeight="Bold"
                         Foreground="{DynamicResource SurfaceBrush}" />
            </StackPanel>
          </Border>

          <!-- Score-Aufschlüsselung (nur bei Level-Complete) -->
          <Border AutomationProperties.AutomationId="GameOver_Summary"
                  Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="10"
                  Padding="14,10"
                  HorizontalAlignment="Center"
                  BoxShadow="0 4 12 0 #40000000"
                  IsVisible="{Binding HasSummary}">
            <StackPanel Spacing="6">
              <!-- Gegner-Punkte -->
              <Border Padding="10,6" CornerRadius="6"
                      BorderThickness="3,0,0,0" BorderBrush="#F44336">
                <Border.Background>
                  <SolidColorBrush Color="#F44336" Opacity="0.06" />
                </Border.Background>
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="{loc:Translate EnemyPoints}"
                             FontSize="14"
                             Foreground="{DynamicResource TextSecondaryBrush}" />
                  <TextBlock AutomationProperties.AutomationId="GameOver_TxtEnemyPoints"
                             Grid.Column="1"
                             Text="{Binding EnemyKillPointsText}"
                             FontSize="14" FontWeight="Bold"
                             Foreground="{DynamicResource TextPrimaryBrush}" />
                </Grid>
              </Border>
              <!-- Zeitbonus -->
              <Border Padding="10,6" CornerRadius="6"
                      BorderThickness="3,0,0,0" BorderBrush="#2196F3">
                <Border.Background>
                  <SolidColorBrush Color="#2196F3" Opacity="0.06" />
                </Border.Background>
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="{loc:Translate SummaryTimeBonus}"
                             FontSize="14"
                             Foreground="{DynamicResource TextSecondaryBrush}" />
                  <TextBlock AutomationProperties.AutomationId="GameOver_TxtTimeBonus"
                             Grid.Column="1"
                             Text="{Binding TimeBonusText}"
                             FontSize="14" FontWeight="Bold"
                             Foreground="#2196F3" />
                </Grid>
              </Border>
              <!-- Effizienzbonus -->
              <Border Padding="10,6" CornerRadius="6"
                      BorderThickness="3,0,0,0" BorderBrush="#FF9800">
                <Border.Background>
                  <SolidColorBrush Color="#FF9800" Opacity="0.06" />
                </Border.Background>
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="{loc:Translate SummaryEfficiencyBonus}"
                             FontSize="14"
                             Foreground="{DynamicResource TextSecondaryBrush}" />
                  <TextBlock AutomationProperties.AutomationId="GameOver_TxtEfficiency"
                             Grid.Column="1"
                             Text="{Binding EfficiencyBonusText}"
                             FontSize="14" FontWeight="Bold"
                             Foreground="#FF9800" />
                </Grid>
              </Border>
              <!-- Score-Multiplikator -->
              <Border Padding="10,6" CornerRadius="6"
                      BorderThickness="3,0,0,0" BorderBrush="#9C27B0">
                <Border.Background>
                  <SolidColorBrush Color="#9C27B0" Opacity="0.06" />
                </Border.Background>
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Text="{loc:Translate SummaryScoreMultiplier}"
                             FontSize="14"
                             Foreground="{DynamicResource TextSecondaryBrush}" />
                  <TextBlock AutomationProperties.AutomationId="GameOver_TxtMultiplier"
                             Grid.Column="1"
                             Text="{Binding ScoreMultiplierText}"
                             FontSize="14" FontWeight="Bold"
                             Foreground="#9C27B0" />
                </Grid>
              </Border>
              <!-- Sterne + Medaille -->
              <StackPanel Orientation="Horizontal" Spacing="8"
                          HorizontalAlignment="Center" Margin="0,4,0,0">
                <!-- Medaille (Gold/Silber/Bronze je nach Sternen) -->
                <ctrl:MedalCanvas AutomationProperties.AutomationId="GameOver_Medal"
                                  Width="36" Height="36"
                                  Stars="{Binding StarsEarned}"
                                  IsVisible="{Binding HasSummary}"
                                  VerticalAlignment="Center" />
                <StackPanel Orientation="Horizontal" Spacing="4"
                            VerticalAlignment="Center">
                  <Panel Width="22" Height="22">
                    <mi:MaterialIcon Kind="StarOutline" Width="22" Height="22" Foreground="#555555" IsVisible="{Binding !Star1Earned}" />
                    <mi:MaterialIcon Kind="Star" Width="22" Height="22" Foreground="{DynamicResource GoldAccentBrush}" IsVisible="{Binding Star1Earned}" />
                  </Panel>
                  <Panel Width="22" Height="22">
                    <mi:MaterialIcon Kind="StarOutline" Width="22" Height="22" Foreground="#555555" IsVisible="{Binding !Star2Earned}" />
                    <mi:MaterialIcon Kind="Star" Width="22" Height="22" Foreground="{DynamicResource GoldAccentBrush}" IsVisible="{Binding Star2Earned}" />
                  </Panel>
                  <Panel Width="22" Height="22">
                    <mi:MaterialIcon Kind="StarOutline" Width="22" Height="22" Foreground="#555555" IsVisible="{Binding !Star3Earned}" />
                    <mi:MaterialIcon Kind="Star" Width="22" Height="22" Foreground="{DynamicResource GoldAccentBrush}" IsVisible="{Binding Star3Earned}" />
                  </Panel>
                </StackPanel>
              </StackPanel>
              <!-- Near-Miss Feedback -->
              <TextBlock AutomationProperties.AutomationId="GameOver_TxtNearMiss"
                         IsVisible="{Binding HasNearMiss}"
                         Text="{Binding NearMissText}"
                         FontSize="14" FontWeight="SemiBold"
                         Foreground="#FF9800"
                         TextWrapping="Wrap"
                         HorizontalAlignment="Center" />
              <!-- Premium Badge -->
              <Border AutomationProperties.AutomationId="GameOver_PremiumBadge"
                      IsVisible="{Binding IsPremium}"
                      Background="#33FFD700"
                      CornerRadius="8"
                      Padding="10,4"
                      HorizontalAlignment="Center"
                      Margin="0,4,0,0">
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <mi:MaterialIcon Kind="Crown" Width="16" Height="16" Foreground="{DynamicResource GoldAccentBrush}" />
                  <TextBlock Text="{loc:Translate PremiumFeatureDoubleCoins}"
                             FontSize="13" FontWeight="Bold"
                             Foreground="{DynamicResource GoldAccentBrush}" />
                </StackPanel>
              </Border>
            </StackPanel>
          </Border>

          <!-- Coins verdient -->
          <Border AutomationProperties.AutomationId="GameOver_CoinsSection"
                  Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="10"
                  Padding="16,10"
                  HorizontalAlignment="Center"
                  BoxShadow="0 4 12 0 #40000000"
                  BorderThickness="3,0,0,0"
                  BorderBrush="#FFD700">
            <StackPanel Spacing="6">
              <StackPanel Orientation="Horizontal" Spacing="8"
                          HorizontalAlignment="Center">
                <mi:MaterialIcon Kind="CircleMultiple" Width="22" Height="22"
                                 Foreground="{DynamicResource GoldAccentBrush}" />
                <TextBlock AutomationProperties.AutomationId="GameOver_TxtCoinsEarned"
                           Text="{Binding CoinsEarnedText}"
                           FontSize="22" FontWeight="Bold"
                           Foreground="{DynamicResource GoldAccentBrush}" />
              </StackPanel>

              <!-- Verdoppeln Button (Primary CTA: groß, Gold, pulsierend) -->
              <Panel MinHeight="48" IsVisible="{Binding CanDoubleCoins}">
                <ctrl:GameButtonCanvas ButtonColor="#E6A800" DamageLevel="0.6" ButtonSeed="41" />
                <Button AutomationProperties.AutomationId="GameOver_BtnDoubleCoins"
                        Command="{Binding DoubleCoinsCommand}"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        CornerRadius="10"
                        Background="Transparent"
                        Foreground="White"
                        Padding="14,10"
                        FontSize="16"
                        Classes="GameButton">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <mi:MaterialIcon Kind="Video" Width="20" Height="20"
                                     Foreground="White" />
                    <TextBlock Text="{Binding DoubleCoinsButtonText}"
                               FontSize="16" FontWeight="Bold"
                               Foreground="White" />
                    <TextBlock Text="x2" FontSize="18" FontWeight="ExtraBold"
                               Foreground="#FFF8E1" />
                  </StackPanel>
                </Button>
              </Panel>

              <!-- Verdoppelt-Anzeige -->
              <TextBlock AutomationProperties.AutomationId="GameOver_TxtDoubled"
                         IsVisible="{Binding HasDoubled}"
                         Text="{Binding DoubleCoinsButtonText}"
                         FontSize="13"
                         Foreground="#4CAF50"
                         HorizontalAlignment="Center" />
            </StackPanel>
          </Border>

        </StackPanel>
        </ScrollViewer>

        <!-- Rechts: Buttons (Primary CTA oben, optionale Aktionen Mitte, Exit unten) -->
        <StackPanel Grid.Column="1"
                    VerticalAlignment="Center"
                    Spacing="14"
                    Margin="16,0">

          <!-- 1. Try Again = Primary CTA (immer sichtbar, groesster Button) -->
          <Panel MinHeight="56">
            <ctrl:GameButtonCanvas ButtonColor="#4CAF50" DamageLevel="0.3" ButtonSeed="40" />
            <Button AutomationProperties.AutomationId="GameOver_BtnTryAgain"
                    Content="{loc:Translate TryAgain}"
                    Classes="Primary GameButton"
                    Background="Transparent"
                    Foreground="White"
                    Command="{Binding TryAgainCommand}"
                    FontSize="20"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center" />
          </Panel>

          <!-- 2. Continue via Ad (nur Story, 1x) -->
          <Panel MinHeight="44" IsVisible="{Binding CanContinue}">
            <ctrl:GameButtonCanvas ButtonColor="#7B1FA2" DamageLevel="0.5" ButtonSeed="42" />
            <Button AutomationProperties.AutomationId="GameOver_BtnContinue"
                    Command="{Binding ContinueGameCommand}"
                    Classes="Primary GameButton"
                    Background="Transparent"
                    Foreground="White"
                    FontSize="15"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <mi:MaterialIcon Kind="Video" Width="18" Height="18"
                                 Foreground="White" />
                <TextBlock Text="{Binding ContinueButtonText}"
                           Foreground="White" />
              </StackPanel>
            </Button>
          </Panel>

          <!-- 3. Paid Continue (199 Coins, Alternative zur Ad) -->
          <Panel MinHeight="40" IsVisible="{Binding CanPaidContinue}">
            <ctrl:GameButtonCanvas ButtonColor="#FFD700" DamageLevel="0.6" ButtonSeed="43" />
            <Button AutomationProperties.AutomationId="GameOver_BtnPaidContinue"
                    Command="{Binding PaidContinueCommand}"
                    Classes="Primary GameButton"
                    Background="Transparent"
                    Foreground="White"
                    FontSize="14"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="CircleMultiple" Width="16" Height="16"
                                 Foreground="#FFF8E1" />
                <TextBlock Text="{Binding PaidContinueText}"
                           FontSize="14" FontWeight="Bold"
                           Foreground="White" />
              </StackPanel>
            </Button>
          </Panel>

          <!-- 4. Level-Skip Button (nach 2x Game Over) -->
          <Panel MinHeight="40" IsVisible="{Binding CanSkipLevel}">
            <ctrl:GameButtonCanvas ButtonColor="#FF9800" DamageLevel="0.5" ButtonSeed="44" />
            <Button AutomationProperties.AutomationId="GameOver_BtnSkipLevel"
                    Command="{Binding SkipLevelCommand}"
                    Classes="Primary GameButton"
                    Background="Transparent"
                    Foreground="White"
                    FontSize="14"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center">
              <StackPanel Spacing="2" HorizontalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="6"
                            HorizontalAlignment="Center">
                  <mi:MaterialIcon Kind="SkipNext" Width="18" Height="18"
                                   Foreground="White" />
                  <TextBlock Text="{Binding SkipLevelText}"
                             FontSize="14" FontWeight="SemiBold"
                             Foreground="White" />
                </StackPanel>
                <TextBlock Text="{Binding SkipLevelInfoText}"
                           FontSize="10"
                           Foreground="#CCFFFFFF"
                           HorizontalAlignment="Center" />
              </StackPanel>
            </Button>
          </Panel>

          <!-- 5. Main Menu = Secondary (unten, dezenter) -->
          <Panel MinHeight="44">
            <ctrl:GameButtonCanvas ButtonColor="#555555" DamageLevel="0.3" ButtonSeed="45" />
            <Button AutomationProperties.AutomationId="GameOver_BtnMainMenu"
                    Content="{loc:Translate MainMenu}"
                    Classes="Secondary GameButton"
                    Background="Transparent"
                    Foreground="White"
                    Command="{Binding MainMenuCommand}"
                    FontSize="16"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center" />
          </Panel>
        </StackPanel>
      </Grid>

    </Grid>
  </Panel>

</UserControl>
