<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BomberBlast.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:skia="using:Avalonia.Labs.Controls"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             x:Class="BomberBlast.Views.GameView"
             x:DataType="vm:GameViewModel"
             Focusable="True">

  <Panel AutomationProperties.AutomationId="Game_Root">
    <!-- SkiaSharp Game Canvas -->
    <Border Background="Black">
      <skia:SKCanvasView x:Name="GameCanvas" AutomationProperties.AutomationId="Game_Canvas" />
    </Border>

    <!-- Score Double Overlay (nach Level-Complete) -->
    <Border IsVisible="{Binding ShowScoreDoubleOverlay}"
            Background="#CC000000"
            ZIndex="50"
            AutomationProperties.AutomationId="Game_ScoreDoubleOverlay">
      <Border Background="{DynamicResource SurfaceBrush}"
              CornerRadius="20"
              Padding="32,24"
              VerticalAlignment="Center"
              HorizontalAlignment="Center"
              MaxWidth="420"
              BorderBrush="{DynamicResource CardBorderBrush}"
              BorderThickness="1"
              BoxShadow="0 4 16 0 #40000000">
        <StackPanel Spacing="16" HorizontalAlignment="Center">

          <!-- Titel -->
          <TextBlock Text="{loc:Translate LevelComplete}"
                     FontSize="32"
                     FontWeight="Bold"
                     Foreground="{DynamicResource SuccessBrush}"
                     HorizontalAlignment="Center"
                     AutomationProperties.AutomationId="Game_TxtLevelComplete" />

          <!-- Score -->
          <StackPanel Spacing="4" HorizontalAlignment="Center">
            <TextBlock Text="{loc:Translate Score}"
                       FontSize="14"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       HorizontalAlignment="Center"
                       AutomationProperties.AutomationId="Game_TxtScoreLabel" />
            <TextBlock Text="{Binding LevelCompleteScoreText}"
                       FontSize="36"
                       FontWeight="Bold"
                       Foreground="#FFD700"
                       HorizontalAlignment="Center"
                       AutomationProperties.AutomationId="Game_TxtScore" />
          </StackPanel>

          <!-- Verdoppeln-Frage -->
          <TextBlock Text="{loc:Translate ScoreDoubleDesc}"
                     FontSize="14"
                     Foreground="{DynamicResource TextSecondaryBrush}"
                     HorizontalAlignment="Center"
                     TextWrapping="Wrap"
                     TextAlignment="Center"
                     AutomationProperties.AutomationId="Game_TxtScoreDoubleDesc" />

          <!-- Buttons -->
          <StackPanel Spacing="10">
            <!-- Video schauen -> Score x2 -->
            <Button Command="{Binding DoubleScoreCommand}"
                    IsVisible="{Binding CanDoubleScore}"
                    Classes="Primary"
                    Background="#7B1FA2"
                    Height="52"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    CornerRadius="12"
                    AutomationProperties.AutomationId="Game_BtnDoubleScore">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <mi:MaterialIcon Kind="Video" Width="20" Height="20"
                                 Foreground="White" />
                <TextBlock Text="{loc:Translate WatchVideoDouble}"
                           FontSize="16" FontWeight="SemiBold"
                           Foreground="White" />
              </StackPanel>
            </Button>

            <!-- Weiter ohne Verdopplung -->
            <Button Command="{Binding SkipDoubleScoreCommand}"
                    Classes="Secondary"
                    Height="44"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    CornerRadius="10"
                    AutomationProperties.AutomationId="Game_BtnSkipDouble">
              <TextBlock Text="{loc:Translate ContinueWithout}"
                         FontSize="14"
                         Foreground="{DynamicResource TextPrimaryBrush}" />
            </Button>
          </StackPanel>
        </StackPanel>
      </Border>
    </Border>

    <!-- Pause Overlay (triggered by Escape key) -->
    <Border IsVisible="{Binding IsPaused}"
            Background="#CC000000"
            AutomationProperties.AutomationId="Game_PauseOverlay">
      <Border Background="{DynamicResource SurfaceBrush}"
              CornerRadius="20"
              Padding="24"
              VerticalAlignment="Center"
              HorizontalAlignment="Center"
              MaxWidth="400"
              BorderBrush="{DynamicResource CardBorderBrush}"
              BorderThickness="1">
        <StackPanel Spacing="16">
          <TextBlock Text="{loc:Translate Paused}"
                     FontSize="36"
                     FontWeight="Bold"
                     Foreground="{DynamicResource TextPrimaryBrush}"
                     HorizontalAlignment="Center"
                     AutomationProperties.AutomationId="Game_TxtPaused" />

          <!-- 2x2 Button Grid -->
          <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto">
            <Button Grid.Row="0" Grid.Column="0"
                    Content="{loc:Translate Resume}"
                    Classes="Primary"
                    Background="{DynamicResource SuccessBrush}"
                    Command="{Binding ResumeCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Height="48"
                    Margin="0,0,6,6"
                    AutomationProperties.AutomationId="Game_BtnResume" />

            <Button Grid.Row="0" Grid.Column="1"
                    Content="{loc:Translate RestartLevel}"
                    Classes="Primary"
                    Background="{DynamicResource WarningBrush}"
                    Command="{Binding RestartCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Height="48"
                    Margin="6,0,0,6"
                    AutomationProperties.AutomationId="Game_BtnRestart" />

            <Button Grid.Row="1" Grid.Column="0"
                    Content="{loc:Translate Settings}"
                    Classes="Secondary"
                    Command="{Binding SettingsCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Height="48"
                    Margin="0,6,6,0"
                    AutomationProperties.AutomationId="Game_BtnPauseSettings" />

            <Button Grid.Row="1" Grid.Column="1"
                    Content="{loc:Translate QuitToMenu}"
                    Classes="Primary"
                    Background="{DynamicResource ErrorBrush}"
                    Command="{Binding QuitToMenuCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Height="48"
                    Margin="6,6,0,0"
                    AutomationProperties.AutomationId="Game_BtnQuitToMenu" />
          </Grid>
        </StackPanel>
      </Border>
    </Border>
  </Panel>

</UserControl>
