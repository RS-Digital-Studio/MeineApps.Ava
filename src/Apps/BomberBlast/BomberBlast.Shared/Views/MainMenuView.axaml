<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BomberBlast.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             xmlns:models="using:BomberBlast.Models"
             xmlns:controls="using:BomberBlast.Controls"
             x:Class="BomberBlast.Views.MainMenuView"
             x:DataType="vm:MainMenuViewModel">

  <!-- Background -->
  <Panel AutomationProperties.AutomationId="MainMenu_Root">
    <controls:MenuBackgroundCanvas />

    <Grid RowDefinitions="*,Auto" Margin="20,8,20,8">

      <!-- ═══ HAUPTBEREICH: 3 Spalten (Titel | Spielmodi | Meta) ═══ -->
      <Grid Grid.Row="0"
            ColumnDefinitions="0.8*,1.2*,1.2*"
            VerticalAlignment="Center">

        <!-- ═══ Spalte 0: Titel + Währungen ═══ -->
        <StackPanel Grid.Column="0"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Spacing="0">
          <!-- Logo-Bereich mit subtlem Gradient -->
          <Border CornerRadius="16" Padding="20,16" HorizontalAlignment="Center">
            <Border.Background>
              <LinearGradientBrush StartPoint="50%,0%" EndPoint="50%,100%">
                <GradientStop Color="#30FF6B00" Offset="0" />
                <GradientStop Color="#10000000" Offset="1" />
              </LinearGradientBrush>
            </Border.Background>
            <StackPanel Spacing="0">
              <TextBlock Text="BOMBER"
                         FontSize="36"
                         FontWeight="Bold"
                         Foreground="{DynamicResource SecondaryBrush}"
                         HorizontalAlignment="Center"
                         AutomationProperties.AutomationId="MainMenu_TxtBomber" />
              <TextBlock Text="BLAST"
                         FontSize="36"
                         FontWeight="Bold"
                         Foreground="{DynamicResource AccentBrush}"
                         HorizontalAlignment="Center"
                         Margin="0,-10,0,0"
                         AutomationProperties.AutomationId="MainMenu_TxtBlast" />
            </StackPanel>
          </Border>

          <!-- Coin-Badge mit goldenem Rand -->
          <Border Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="14"
                  Padding="12,5"
                  Margin="0,12,0,0"
                  HorizontalAlignment="Center"
                  BorderThickness="1" BorderBrush="#40FFD700"
                  AutomationProperties.AutomationId="MainMenu_CoinBadge">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <mi:MaterialIcon Kind="CircleMultiple" Width="18" Height="18"
                               Foreground="#FFD700" />
              <TextBlock Text="{Binding CoinsText}"
                         FontSize="14" FontWeight="SemiBold"
                         Foreground="#FFD700"
                         VerticalAlignment="Center"
                         AutomationProperties.AutomationId="MainMenu_TxtCoins" />
            </StackPanel>
          </Border>

          <!-- Gem-Badge (tappbar → Gem-Shop) mit lila Rand -->
          <Button Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="14"
                  Padding="12,5"
                  Margin="0,4,0,0"
                  HorizontalAlignment="Center"
                  BorderThickness="1" BorderBrush="#40E040FB"
                  Command="{Binding GoToGemShopCommand}"
                  AutomationProperties.AutomationId="MainMenu_GemBadge">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <mi:MaterialIcon Kind="DiamondStone" Width="18" Height="18"
                               Foreground="#E040FB" />
              <TextBlock Text="{Binding GemsText}"
                         FontSize="14" FontWeight="SemiBold"
                         Foreground="#E040FB"
                         VerticalAlignment="Center"
                         AutomationProperties.AutomationId="MainMenu_TxtGems" />
            </StackPanel>
          </Button>

          <TextBlock Text="{Binding TotalEarnedText}"
                     FontSize="11"
                     Foreground="{DynamicResource TextMutedBrush}"
                     HorizontalAlignment="Center"
                     Margin="0,6,0,0"
                     AutomationProperties.AutomationId="MainMenu_TxtTotalEarned" />

          <TextBlock Text="{Binding VersionText}"
                     FontSize="10"
                     Foreground="{DynamicResource TextMutedBrush}"
                     HorizontalAlignment="Center"
                     Margin="0,2,0,0"
                     AutomationProperties.AutomationId="MainMenu_TxtVersion" />
        </StackPanel>

        <!-- ═══ Spalte 1: Spielmodi ═══ -->
        <StackPanel Grid.Column="1"
                    VerticalAlignment="Center"
                    Margin="16,0,4,0"
                    Spacing="4">

          <!-- Story Mode = Primary CTA -->
          <Panel Height="48">
            <controls:GameButtonCanvas ButtonColor="#00BCD4" DamageLevel="0.5" ButtonSeed="10" />
            <Button Content="{loc:Translate StoryMode}"
                    Classes="Primary GameButton"
                    Background="Transparent"
                    Command="{Binding StoryModeCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center"
                    FontSize="18" FontWeight="Bold"
                    Foreground="White"
                    AutomationProperties.AutomationId="MainMenu_BtnStoryMode" />
          </Panel>

          <!-- Continue (nur wenn Fortschritt) -->
          <Panel MinHeight="36" IsVisible="{Binding HasProgress}">
            <controls:GameButtonCanvas ButtonColor="#4CAF50" DamageLevel="0.3" ButtonSeed="11" />
            <Button Content="{loc:Translate Continue}"
                    Classes="Primary GameButton"
                    Background="Transparent"
                    Command="{Binding ContinueCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center"
                    Foreground="White"
                    AutomationProperties.AutomationId="MainMenu_BtnContinue" />
          </Panel>

          <!-- Survival + QuickPlay nebeneinander -->
          <Grid ColumnDefinitions="*,*"
                IsVisible="{Binding IsSurvivalUnlocked}">
            <Panel Grid.Column="0" Margin="0,0,2,0" MinHeight="36">
              <controls:GameButtonCanvas ButtonColor="#B71C1C" DamageLevel="0.7" ButtonSeed="12" />
              <Button Classes="Primary GameButton"
                      Background="Transparent"
                      Command="{Binding SurvivalModeCommand}"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"
                      VerticalContentAlignment="Center"
                      AutomationProperties.AutomationId="MainMenu_BtnSurvival">
                <StackPanel Orientation="Horizontal" Spacing="3">
                  <mi:MaterialIcon Kind="Skull" Width="12" Height="12"
                                   Foreground="White" />
                  <TextBlock Text="{loc:Translate SurvivalMode}"
                             Foreground="White"
                             FontSize="13" />
                </StackPanel>
              </Button>
            </Panel>
            <Panel Grid.Column="1" Margin="2,0,0,0" MinHeight="36">
              <controls:GameButtonCanvas ButtonColor="#FF9800" DamageLevel="0.4" ButtonSeed="13" />
              <Button Content="{loc:Translate QuickPlay}"
                      Classes="Primary GameButton"
                      Background="Transparent"
                      Command="{Binding QuickPlayCommand}"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"
                      VerticalContentAlignment="Center"
                      FontSize="13" Foreground="White"
                      AutomationProperties.AutomationId="MainMenu_BtnQuickPlay" />
            </Panel>
          </Grid>

          <!-- Dungeon (volle Breite) -->
          <Panel MinHeight="36" IsVisible="{Binding IsDungeonUnlocked}">
            <controls:GameButtonCanvas ButtonColor="#4A148C" DamageLevel="0.6" ButtonSeed="14" />
            <Button Classes="Primary GameButton"
                    Background="Transparent"
                    Command="{Binding DungeonCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center"
                    AutomationProperties.AutomationId="MainMenu_BtnDungeon">
              <StackPanel Orientation="Horizontal" Spacing="4">
                <mi:MaterialIcon Kind="Sword" Width="14" Height="14"
                                 Foreground="#E040FB" />
                <TextBlock Text="{loc:Translate DungeonButton}"
                           Foreground="White"
                           FontSize="14" />
              </StackPanel>
            </Button>
          </Panel>

        </StackPanel>

        <!-- ═══ Spalte 2: Meta / Sammlung ═══ -->
        <StackPanel Grid.Column="2"
                    VerticalAlignment="Center"
                    Margin="4,0,0,0"
                    Spacing="4">

          <!-- Battle Pass (Eye-Catcher, oben) -->
          <Panel MinHeight="36" IsVisible="{Binding IsBattlePassUnlocked}">
            <controls:GameButtonCanvas ButtonColor="#FFD700" DamageLevel="0.6" ButtonSeed="20" />
            <Button Classes="Primary GameButton"
                    Background="Transparent"
                    Command="{Binding BattlePassCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center"
                    AutomationProperties.AutomationId="MainMenu_BtnBattlePass">
              <StackPanel Orientation="Horizontal" Spacing="6">
                <mi:MaterialIcon Kind="Shield" Width="14" Height="14"
                                 Foreground="White" />
                <TextBlock Text="{loc:Translate BattlePassButton}"
                           Foreground="White"
                           FontSize="14" FontWeight="SemiBold" />
              </StackPanel>
            </Button>
          </Panel>

          <!-- Karten + Liga nebeneinander -->
          <Grid ColumnDefinitions="*,*">
            <Panel Grid.Column="0" Margin="0,0,2,0" MinHeight="36"
                   IsVisible="{Binding IsDeckUnlocked}">
              <controls:GameButtonCanvas ButtonColor="#1565C0" DamageLevel="0.4" ButtonSeed="21" />
              <Button Classes="Primary GameButton"
                      Background="Transparent"
                      Command="{Binding DeckCommand}"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"
                      VerticalContentAlignment="Center"
                      AutomationProperties.AutomationId="MainMenu_BtnCards">
                <StackPanel Orientation="Horizontal" Spacing="4">
                  <mi:MaterialIcon Kind="CardsPlaying" Width="14" Height="14"
                                   Foreground="White" />
                  <TextBlock Text="{loc:Translate DeckButton}"
                             Foreground="White"
                             FontSize="13" TextTrimming="CharacterEllipsis" />
                </StackPanel>
              </Button>
            </Panel>

            <Panel Grid.Column="1" Margin="2,0,0,0" MinHeight="36"
                   IsVisible="{Binding IsLeagueUnlocked}">
              <controls:GameButtonCanvas ButtonColor="#00CED1" DamageLevel="0.3" ButtonSeed="22" />
              <Button Classes="Secondary GameButton"
                      Background="Transparent"
                      Command="{Binding LeagueCommand}"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"
                      VerticalContentAlignment="Center"
                      AutomationProperties.AutomationId="MainMenu_BtnLeague">
                <StackPanel Orientation="Horizontal" Spacing="4">
                  <mi:MaterialIcon Kind="Trophy" Width="14" Height="14"
                                   Foreground="White" />
                  <TextBlock Text="{loc:Translate LeagueButton}" FontSize="13" FontWeight="SemiBold"
                             Foreground="White" VerticalAlignment="Center"
                             TextTrimming="CharacterEllipsis" />
                </StackPanel>
              </Button>
            </Panel>
          </Grid>

          <!-- Herausforderungen (volle Breite) -->
          <Panel IsVisible="{Binding IsDailyChallengeUnlocked}">
            <Panel MinHeight="36">
              <controls:GameButtonCanvas ButtonColor="#FF6B00" DamageLevel="0.5" ButtonSeed="23" />
              <Button Classes="Primary GameButton"
                      Background="Transparent"
                      Command="{Binding DailyChallengeCommand}"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Center"
                      VerticalContentAlignment="Center"
                      AutomationProperties.AutomationId="MainMenu_BtnChallenges">
                <StackPanel Orientation="Horizontal" Spacing="4">
                  <mi:MaterialIcon Kind="Sword" Width="14" Height="14"
                                   Foreground="White" />
                  <TextBlock Text="{loc:Translate DailyChallengeTitle}"
                             Foreground="White"
                             FontSize="14" />
                </StackPanel>
              </Button>
            </Panel>
            <!-- "!" Badge wenn Herausforderungen/Missionen offen -->
            <Border IsVisible="{Binding IsDailyChallengeNew}"
                    Background="#FF2020"
                    CornerRadius="6"
                    Padding="4,1"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="0,-3,0,0"
                    AutomationProperties.AutomationId="MainMenu_BadgeChallengesNew">
              <TextBlock Text="{loc:Translate DailyChallengeNew}"
                         FontSize="9" FontWeight="Bold"
                         Foreground="White" />
            </Border>
          </Panel>

        </StackPanel>

      </Grid>

      <!-- ═══ UNTERE LEISTE: 3 Utility-Buttons ═══ -->
      <Grid Grid.Row="1"
            ColumnDefinitions="*,*,*"
            Margin="0,6,0,0">

        <!-- Shop -->
        <Panel Grid.Column="0" Margin="0,0,2,0" Height="40"
               IsVisible="{Binding IsShopUnlocked}">
          <controls:GameButtonCanvas ButtonColor="#FFD700" DamageLevel="0.3" ButtonSeed="30" />
          <Button Classes="Secondary GameButton"
                  Background="Transparent"
                  Command="{Binding ShopCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  VerticalContentAlignment="Center"
                  AutomationProperties.AutomationId="MainMenu_BtnShop">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <mi:MaterialIcon Kind="Store" Width="16" Height="16"
                               Foreground="White" />
              <TextBlock Text="{loc:Translate ShopTitle}"
                         Foreground="White"
                         FontSize="14" />
            </StackPanel>
          </Button>
        </Panel>

        <!-- Profil -->
        <Panel Grid.Column="1" Margin="2,0,2,0" Height="40"
               IsVisible="{Binding IsProfileUnlocked}">
          <controls:GameButtonCanvas ButtonColor="#00BCD4" DamageLevel="0.3" ButtonSeed="31" />
          <Button Classes="Secondary GameButton"
                  Background="Transparent"
                  Command="{Binding ProfileCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  VerticalContentAlignment="Center"
                  AutomationProperties.AutomationId="MainMenu_BtnProfile">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <mi:MaterialIcon Kind="AccountCircle" Width="16" Height="16"
                               Foreground="White" />
              <TextBlock Text="{loc:Translate ProfileTitle}"
                         FontSize="14"
                         Foreground="White" />
            </StackPanel>
          </Button>
        </Panel>

        <!-- Einstellungen -->
        <Panel Grid.Column="2" Margin="2,0,0,0" Height="40">
          <controls:GameButtonCanvas ButtonColor="#607D8B" DamageLevel="0.2" ButtonSeed="32" />
          <Button Classes="Secondary GameButton"
                  Background="Transparent"
                  Command="{Binding SettingsCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  VerticalContentAlignment="Center"
                  AutomationProperties.AutomationId="MainMenu_BtnSettings">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <mi:MaterialIcon Kind="Cog" Width="16" Height="16"
                               Foreground="White" />
              <TextBlock Text="{loc:Translate Settings}"
                         FontSize="14"
                         TextTrimming="CharacterEllipsis"
                         Foreground="White" />
            </StackPanel>
          </Button>
        </Panel>

      </Grid>

    </Grid>

    <!-- Daily Reward Popup Overlay -->
    <Border IsVisible="{Binding IsRewardPopupVisible}"
            Background="#CC000000"
            HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
            AutomationProperties.AutomationId="MainMenu_RewardOverlay">
      <Border Background="{DynamicResource SurfaceBrush}"
              CornerRadius="16" Padding="20"
              MaxWidth="520" MaxHeight="300"
              HorizontalAlignment="Center" VerticalAlignment="Center"
              BoxShadow="0 8 24 0 #60000000"
              RenderTransformOrigin="0.5,0.5">
        <Border.RenderTransform>
          <ScaleTransform ScaleX="1" ScaleY="1" />
        </Border.RenderTransform>
        <Border.Transitions>
          <Transitions>
            <DoubleTransition Property="Opacity" Duration="0:0:0.25" Easing="CubicEaseOut" />
          </Transitions>
        </Border.Transitions>
        <Grid RowDefinitions="Auto,*,Auto">
          <!-- Titel -->
          <StackPanel Orientation="Horizontal" Spacing="8"
                      HorizontalAlignment="Center" Margin="0,0,0,12">
            <mi:MaterialIcon Kind="Gift" Width="24" Height="24" Foreground="#FFD700" />
            <TextBlock Text="{Binding RewardPopupTitle}"
                       FontSize="20" FontWeight="Bold"
                       Foreground="#FFD700"
                       AutomationProperties.AutomationId="MainMenu_TxtRewardTitle" />
          </StackPanel>

          <!-- 7-Tage-Kalender -->
          <ItemsControl Grid.Row="1" ItemsSource="{Binding RewardDays}"
                        AutomationProperties.AutomationId="MainMenu_RewardDays">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <StackPanel Orientation="Horizontal" Spacing="6"
                            HorizontalAlignment="Center" />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="models:DailyRewardDisplayItem">
                <Border Width="58" CornerRadius="8"
                        Padding="4,6"
                        Opacity="{Binding CardOpacity}"
                        BorderThickness="2"
                        BorderBrush="{Binding BorderColor}">
                  <Border.Background>
                    <SolidColorBrush Color="{Binding BackgroundColor}" />
                  </Border.Background>
                  <StackPanel Spacing="4" HorizontalAlignment="Center">
                    <!-- Tag -->
                    <TextBlock Text="{Binding DayText}"
                               FontSize="10" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               HorizontalAlignment="Center" />
                    <!-- Status-Icon -->
                    <Panel Height="20" HorizontalAlignment="Center">
                      <!-- Claimed: Haken -->
                      <mi:MaterialIcon Kind="CheckCircle" Width="20" Height="20"
                                       Foreground="#22C55E"
                                       IsVisible="{Binding IsClaimed}" />
                      <!-- Aktuell: Geschenk -->
                      <mi:MaterialIcon Kind="Gift" Width="20" Height="20"
                                       Foreground="#FFD700"
                                       IsVisible="{Binding IsCurrentDay}" />
                      <!-- Zukunft: Schloss -->
                      <mi:MaterialIcon Kind="Lock" Width="20" Height="20"
                                       Foreground="#666666"
                                       IsVisible="{Binding IsFuture}" />
                    </Panel>
                    <!-- Coins -->
                    <TextBlock Text="{Binding CoinsText}"
                               FontSize="11" FontWeight="Bold"
                               Foreground="#FFD700"
                               HorizontalAlignment="Center" />
                    <!-- Extra-Leben Bonus -->
                    <mi:MaterialIcon Kind="HeartPlus" Width="14" Height="14"
                                     Foreground="#FF4444"
                                     IsVisible="{Binding HasExtraLife}"
                                     HorizontalAlignment="Center" />
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>

          <!-- Buttons -->
          <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="12"
                      HorizontalAlignment="Center" Margin="0,12,0,0">
            <!-- Abholen-Button mit TornMetal-Hintergrund -->
            <Panel Height="44" MinWidth="140">
              <controls:GameButtonCanvas ButtonColor="#FFD700" DamageLevel="0.5" ButtonSeed="33" />
              <Button Command="{Binding ClaimDailyRewardCommand}"
                      Classes="Primary GameButton"
                      Height="44" MinWidth="140"
                      HorizontalContentAlignment="Center"
                      AutomationProperties.AutomationId="MainMenu_BtnClaimReward">
                <TextBlock Text="{Binding RewardClaimText}"
                           FontSize="16" FontWeight="Bold"
                           Foreground="White" />
              </Button>
            </Panel>
            <!-- Schließen-Button mit TornMetal-Hintergrund -->
            <Panel Height="44" MinWidth="56">
              <controls:GameButtonCanvas ButtonColor="#666666" DamageLevel="0.3" ButtonSeed="34" />
              <Button Command="{Binding DismissRewardPopupCommand}"
                      Classes="Secondary GameButton"
                      Height="44" MinWidth="56"
                      HorizontalContentAlignment="Center"
                      AutomationProperties.AutomationId="MainMenu_BtnDismissReward">
                <mi:MaterialIcon Kind="Close" Width="20" Height="20"
                                 Foreground="White" />
              </Button>
            </Panel>
          </StackPanel>
        </Grid>
      </Border>
    </Border>

  </Panel>

</UserControl>
