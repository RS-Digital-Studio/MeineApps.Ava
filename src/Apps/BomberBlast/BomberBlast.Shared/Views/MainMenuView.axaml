<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BomberBlast.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             xmlns:models="using:BomberBlast.Models"
             xmlns:controls="using:BomberBlast.Controls"
             x:Class="BomberBlast.Views.MainMenuView"
             x:DataType="vm:MainMenuViewModel">

  <!-- Background -->
  <Panel AutomationProperties.AutomationId="MainMenu_Root">
    <controls:MenuBackgroundCanvas />

    <Grid RowDefinitions="*,Auto" Margin="20,8,20,8">

      <!-- ═══ HAUPTBEREICH: 3 Spalten (Titel | Spielmodi | Meta) ═══ -->
      <Grid Grid.Row="0"
            ColumnDefinitions="0.8*,1.2*,1.2*"
            VerticalAlignment="Center">

        <!-- ═══ Spalte 0: Titel + Währungen ═══ -->
        <StackPanel Grid.Column="0"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Spacing="0">
          <TextBlock Text="BOMBER"
                     FontSize="36"
                     FontWeight="Bold"
                     Foreground="{DynamicResource SecondaryBrush}"
                     HorizontalAlignment="Center"
                     AutomationProperties.AutomationId="MainMenu_TxtBomber" />
          <TextBlock Text="BLAST"
                     FontSize="36"
                     FontWeight="Bold"
                     Foreground="{DynamicResource AccentBrush}"
                     HorizontalAlignment="Center"
                     Margin="0,-10,0,0"
                     AutomationProperties.AutomationId="MainMenu_TxtBlast" />

          <!-- Coin-Badge -->
          <Border Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="14"
                  Padding="12,5"
                  Margin="0,12,0,0"
                  HorizontalAlignment="Center"
                  AutomationProperties.AutomationId="MainMenu_CoinBadge">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <mi:MaterialIcon Kind="CircleMultiple" Width="18" Height="18"
                               Foreground="#FFD700" />
              <TextBlock Text="{Binding CoinsText}"
                         FontSize="14" FontWeight="SemiBold"
                         Foreground="#FFD700"
                         VerticalAlignment="Center"
                         AutomationProperties.AutomationId="MainMenu_TxtCoins" />
            </StackPanel>
          </Border>

          <!-- Gem-Badge (tappbar → Gem-Shop) -->
          <Button Background="{DynamicResource SurfaceBrush}"
                  CornerRadius="14"
                  Padding="12,5"
                  Margin="0,4,0,0"
                  HorizontalAlignment="Center"
                  Command="{Binding GoToGemShopCommand}"
                  AutomationProperties.AutomationId="MainMenu_GemBadge">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <mi:MaterialIcon Kind="DiamondStone" Width="18" Height="18"
                               Foreground="#E040FB" />
              <TextBlock Text="{Binding GemsText}"
                         FontSize="14" FontWeight="SemiBold"
                         Foreground="#E040FB"
                         VerticalAlignment="Center"
                         AutomationProperties.AutomationId="MainMenu_TxtGems" />
            </StackPanel>
          </Button>

          <TextBlock Text="{Binding TotalEarnedText}"
                     FontSize="11"
                     Foreground="{DynamicResource TextMutedBrush}"
                     HorizontalAlignment="Center"
                     Margin="0,6,0,0"
                     AutomationProperties.AutomationId="MainMenu_TxtTotalEarned" />

          <TextBlock Text="{Binding VersionText}"
                     FontSize="10"
                     Foreground="{DynamicResource TextMutedBrush}"
                     HorizontalAlignment="Center"
                     Margin="0,2,0,0"
                     AutomationProperties.AutomationId="MainMenu_TxtVersion" />
        </StackPanel>

        <!-- ═══ Spalte 1: Spielmodi ═══ -->
        <StackPanel Grid.Column="1"
                    VerticalAlignment="Center"
                    Margin="16,0,4,0"
                    Spacing="4">

          <!-- Story Mode = Primary CTA -->
          <Button Content="{loc:Translate StoryMode}"
                  Classes="Primary GameButton"
                  Command="{Binding StoryModeCommand}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  FontSize="18"
                  Height="48"
                  AutomationProperties.AutomationId="MainMenu_BtnStoryMode" />

          <!-- Continue (nur wenn Fortschritt) -->
          <Button Content="{loc:Translate Continue}"
                  Classes="Primary GameButton"
                  Background="{DynamicResource SuccessBrush}"
                  Command="{Binding ContinueCommand}"
                  IsVisible="{Binding HasProgress}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  MinHeight="36"
                  AutomationProperties.AutomationId="MainMenu_BtnContinue" />

          <!-- Survival + QuickPlay nebeneinander -->
          <Grid ColumnDefinitions="*,*"
                IsVisible="{Binding IsSurvivalUnlocked}">
            <Button Grid.Column="0"
                    Classes="Primary GameButton"
                    Background="#B71C1C"
                    Command="{Binding SurvivalModeCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Margin="0,0,2,0"
                    MinHeight="36"
                    AutomationProperties.AutomationId="MainMenu_BtnSurvival">
              <StackPanel Orientation="Horizontal" Spacing="3">
                <mi:MaterialIcon Kind="Skull" Width="12" Height="12"
                                 Foreground="White" />
                <TextBlock Text="{loc:Translate SurvivalMode}"
                           Foreground="White"
                           FontSize="13" />
              </StackPanel>
            </Button>
            <Button Grid.Column="1"
                    Content="{loc:Translate QuickPlay}"
                    Classes="Primary GameButton"
                    Background="{DynamicResource WarningBrush}"
                    Command="{Binding QuickPlayCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    FontSize="13"
                    Margin="2,0,0,0"
                    MinHeight="36"
                    AutomationProperties.AutomationId="MainMenu_BtnQuickPlay" />
          </Grid>

          <!-- Dungeon (volle Breite) -->
          <Button Classes="Primary GameButton"
                  Background="#4A148C"
                  Command="{Binding DungeonCommand}"
                  IsVisible="{Binding IsDungeonUnlocked}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  MinHeight="36"
                  AutomationProperties.AutomationId="MainMenu_BtnDungeon">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <mi:MaterialIcon Kind="Sword" Width="14" Height="14"
                               Foreground="#E040FB" />
              <TextBlock Text="{loc:Translate DungeonButton}"
                         Foreground="White"
                         FontSize="14" />
            </StackPanel>
          </Button>

        </StackPanel>

        <!-- ═══ Spalte 2: Meta / Sammlung ═══ -->
        <StackPanel Grid.Column="2"
                    VerticalAlignment="Center"
                    Margin="4,0,0,0"
                    Spacing="4">

          <!-- Battle Pass (Eye-Catcher, oben) -->
          <Button Classes="Primary GameButton"
                  Command="{Binding BattlePassCommand}"
                  IsVisible="{Binding IsBattlePassUnlocked}"
                  HorizontalAlignment="Stretch"
                  HorizontalContentAlignment="Center"
                  MinHeight="36"
                  AutomationProperties.AutomationId="MainMenu_BtnBattlePass">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <mi:MaterialIcon Kind="Shield" Width="14" Height="14"
                               Foreground="#FFD700" />
              <TextBlock Text="{loc:Translate BattlePassButton}"
                         Foreground="White"
                         FontSize="14" />
            </StackPanel>
            <Button.Background>
              <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,0%">
                <GradientStop Color="#FF8F00" Offset="0" />
                <GradientStop Color="#FFD700" Offset="1" />
              </LinearGradientBrush>
            </Button.Background>
          </Button>

          <!-- Karten + Liga nebeneinander -->
          <Grid ColumnDefinitions="*,*">
            <Button Grid.Column="0"
                    Classes="Primary GameButton"
                    Background="#1565C0"
                    Command="{Binding DeckCommand}"
                    IsVisible="{Binding IsDeckUnlocked}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Margin="0,0,2,0"
                    MinHeight="36"
                    AutomationProperties.AutomationId="MainMenu_BtnCards">
              <StackPanel Orientation="Horizontal" Spacing="4">
                <mi:MaterialIcon Kind="CardsPlaying" Width="14" Height="14"
                                 Foreground="White" />
                <TextBlock Text="{loc:Translate DeckButton}"
                           Foreground="White"
                           FontSize="13" TextTrimming="CharacterEllipsis" />
              </StackPanel>
            </Button>

            <Button Grid.Column="1"
                    Classes="Secondary GameButton"
                    Command="{Binding LeagueCommand}"
                    IsVisible="{Binding IsLeagueUnlocked}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Margin="2,0,0,0"
                    MinHeight="36"
                    AutomationProperties.AutomationId="MainMenu_BtnLeague">
              <StackPanel Orientation="Horizontal" Spacing="4">
                <mi:MaterialIcon Kind="Trophy" Width="14" Height="14"
                                 Foreground="#00CED1" />
                <TextBlock Text="{loc:Translate LeagueButton}" FontSize="13" FontWeight="SemiBold"
                           Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis" />
              </StackPanel>
            </Button>
          </Grid>

          <!-- Herausforderungen (volle Breite) -->
          <Panel IsVisible="{Binding IsDailyChallengeUnlocked}">
            <Button Classes="Primary GameButton"
                    Background="#FF6B00"
                    Command="{Binding DailyChallengeCommand}"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    MinHeight="36"
                    AutomationProperties.AutomationId="MainMenu_BtnChallenges">
              <StackPanel Orientation="Horizontal" Spacing="4">
                <mi:MaterialIcon Kind="Sword" Width="14" Height="14"
                                 Foreground="White" />
                <TextBlock Text="{loc:Translate DailyChallengeTitle}"
                           Foreground="White"
                           FontSize="14" />
              </StackPanel>
            </Button>
            <!-- "!" Badge wenn Herausforderungen/Missionen offen -->
            <Border IsVisible="{Binding IsDailyChallengeNew}"
                    Background="#FF2020"
                    CornerRadius="6"
                    Padding="4,1"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="0,-3,0,0"
                    AutomationProperties.AutomationId="MainMenu_BadgeChallengesNew">
              <TextBlock Text="{loc:Translate DailyChallengeNew}"
                         FontSize="9" FontWeight="Bold"
                         Foreground="White" />
            </Border>
          </Panel>

        </StackPanel>

      </Grid>

      <!-- ═══ UNTERE LEISTE: 3 Utility-Buttons ═══ -->
      <Grid Grid.Row="1"
            ColumnDefinitions="*,*,*"
            Margin="0,6,0,0">

        <!-- Shop -->
        <Button Grid.Column="0"
                Classes="Secondary GameButton"
                Command="{Binding ShopCommand}"
                IsVisible="{Binding IsShopUnlocked}"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                Margin="0,0,2,0"
                Height="36"
                AutomationProperties.AutomationId="MainMenu_BtnShop">
          <StackPanel Orientation="Horizontal" Spacing="4">
            <mi:MaterialIcon Kind="Store" Width="16" Height="16"
                             Foreground="{DynamicResource TextPrimaryBrush}" />
            <TextBlock Text="{loc:Translate ShopTitle}"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       FontSize="14" />
          </StackPanel>
        </Button>

        <!-- Profil -->
        <Button Grid.Column="1"
                Classes="Secondary GameButton"
                Command="{Binding ProfileCommand}"
                IsVisible="{Binding IsProfileUnlocked}"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                Margin="2,0,2,0"
                Height="36"
                AutomationProperties.AutomationId="MainMenu_BtnProfile">
          <StackPanel Orientation="Horizontal" Spacing="4">
            <mi:MaterialIcon Kind="AccountCircle" Width="16" Height="16"
                             Foreground="#00BCD4" />
            <TextBlock Text="{loc:Translate ProfileTitle}"
                       FontSize="14"
                       Foreground="{DynamicResource TextPrimaryBrush}" />
          </StackPanel>
        </Button>

        <!-- Einstellungen -->
        <Button Grid.Column="2"
                Classes="Secondary GameButton"
                Command="{Binding SettingsCommand}"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Center"
                Margin="2,0,0,0"
                Height="36"
                AutomationProperties.AutomationId="MainMenu_BtnSettings">
          <StackPanel Orientation="Horizontal" Spacing="4">
            <mi:MaterialIcon Kind="Cog" Width="16" Height="16"
                             Foreground="{DynamicResource TextSecondaryBrush}" />
            <TextBlock Text="{loc:Translate Settings}"
                       FontSize="14"
                       TextTrimming="CharacterEllipsis"
                       Foreground="{DynamicResource TextSecondaryBrush}" />
          </StackPanel>
        </Button>

      </Grid>

    </Grid>

    <!-- Daily Reward Popup Overlay -->
    <Border IsVisible="{Binding IsRewardPopupVisible}"
            Background="#CC000000"
            HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
            AutomationProperties.AutomationId="MainMenu_RewardOverlay">
      <Border Background="{DynamicResource SurfaceBrush}"
              CornerRadius="16" Padding="20"
              MaxWidth="520" MaxHeight="300"
              HorizontalAlignment="Center" VerticalAlignment="Center"
              BoxShadow="0 8 24 0 #60000000"
              RenderTransformOrigin="0.5,0.5">
        <Border.RenderTransform>
          <ScaleTransform ScaleX="1" ScaleY="1" />
        </Border.RenderTransform>
        <Border.Transitions>
          <Transitions>
            <DoubleTransition Property="Opacity" Duration="0:0:0.25" Easing="CubicEaseOut" />
          </Transitions>
        </Border.Transitions>
        <Grid RowDefinitions="Auto,*,Auto">
          <!-- Titel -->
          <StackPanel Orientation="Horizontal" Spacing="8"
                      HorizontalAlignment="Center" Margin="0,0,0,12">
            <mi:MaterialIcon Kind="Gift" Width="24" Height="24" Foreground="#FFD700" />
            <TextBlock Text="{Binding RewardPopupTitle}"
                       FontSize="20" FontWeight="Bold"
                       Foreground="#FFD700"
                       AutomationProperties.AutomationId="MainMenu_TxtRewardTitle" />
          </StackPanel>

          <!-- 7-Tage-Kalender -->
          <ItemsControl Grid.Row="1" ItemsSource="{Binding RewardDays}"
                        AutomationProperties.AutomationId="MainMenu_RewardDays">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <StackPanel Orientation="Horizontal" Spacing="6"
                            HorizontalAlignment="Center" />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="models:DailyRewardDisplayItem">
                <Border Width="58" CornerRadius="8"
                        Padding="4,6"
                        Opacity="{Binding CardOpacity}"
                        BorderThickness="2"
                        BorderBrush="{Binding BorderColor}">
                  <Border.Background>
                    <SolidColorBrush Color="{Binding BackgroundColor}" />
                  </Border.Background>
                  <StackPanel Spacing="4" HorizontalAlignment="Center">
                    <!-- Tag -->
                    <TextBlock Text="{Binding DayText}"
                               FontSize="10" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               HorizontalAlignment="Center" />
                    <!-- Status-Icon -->
                    <Panel Height="20" HorizontalAlignment="Center">
                      <!-- Claimed: Haken -->
                      <mi:MaterialIcon Kind="CheckCircle" Width="20" Height="20"
                                       Foreground="#22C55E"
                                       IsVisible="{Binding IsClaimed}" />
                      <!-- Aktuell: Geschenk -->
                      <mi:MaterialIcon Kind="Gift" Width="20" Height="20"
                                       Foreground="#FFD700"
                                       IsVisible="{Binding IsCurrentDay}" />
                      <!-- Zukunft: Schloss -->
                      <mi:MaterialIcon Kind="Lock" Width="20" Height="20"
                                       Foreground="#666666"
                                       IsVisible="{Binding IsFuture}" />
                    </Panel>
                    <!-- Coins -->
                    <TextBlock Text="{Binding CoinsText}"
                               FontSize="11" FontWeight="Bold"
                               Foreground="#FFD700"
                               HorizontalAlignment="Center" />
                    <!-- Extra-Leben Bonus -->
                    <mi:MaterialIcon Kind="HeartPlus" Width="14" Height="14"
                                     Foreground="#FF4444"
                                     IsVisible="{Binding HasExtraLife}"
                                     HorizontalAlignment="Center" />
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>

          <!-- Buttons -->
          <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="12"
                      HorizontalAlignment="Center" Margin="0,12,0,0">
            <Button Command="{Binding ClaimDailyRewardCommand}"
                    Classes="Primary GameButton"
                    Background="#FFD700"
                    Height="44" MinWidth="140"
                    HorizontalContentAlignment="Center"
                    AutomationProperties.AutomationId="MainMenu_BtnClaimReward">
              <TextBlock Text="{Binding RewardClaimText}"
                         FontSize="16" FontWeight="Bold"
                         Foreground="#1A1A2A" />
            </Button>
            <Button Command="{Binding DismissRewardPopupCommand}"
                    Classes="Secondary GameButton"
                    Height="44" MinWidth="100"
                    HorizontalContentAlignment="Center"
                    AutomationProperties.AutomationId="MainMenu_BtnDismissReward">
              <mi:MaterialIcon Kind="Close" Width="20" Height="20"
                               Foreground="{DynamicResource TextSecondaryBrush}" />
            </Button>
          </StackPanel>
        </Grid>
      </Border>
    </Border>

  </Panel>

</UserControl>
