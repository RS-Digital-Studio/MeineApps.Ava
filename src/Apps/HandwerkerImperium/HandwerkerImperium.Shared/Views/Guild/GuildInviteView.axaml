<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:HandwerkerImperium.ViewModels"
             xmlns:mi="using:Material.Icons.Avalonia"
             xmlns:loc="using:MeineApps.Core.Ava.Localization"
             x:Class="HandwerkerImperium.Views.Guild.GuildInviteView"
             x:DataType="vm:GuildViewModel">

  <Grid RowDefinitions="Auto,*"
        AutomationProperties.AutomationId="GuildInvite_Grid_Root">

    <!-- ================================================================= -->
    <!-- HEADER                                                            -->
    <!-- ================================================================= -->
    <Border Grid.Row="0" Padding="16,12" CornerRadius="0,0,12,12">
      <Border.Background>
        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
          <GradientStop Color="#92400E" Offset="0" />
          <GradientStop Color="#451A03" Offset="1" />
        </LinearGradientBrush>
      </Border.Background>
      <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
        <!-- Zurück -->
        <Button Grid.Column="0" Classes="Text" Padding="4"
                Command="{Binding NavigateBackCommand}">
          <mi:MaterialIcon Kind="ArrowLeft" Width="24" Height="24" Foreground="White" />
        </Button>
        <!-- Titel -->
        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8"
                    HorizontalAlignment="Center">
          <mi:MaterialIcon Kind="EmailPlusOutline" Width="24" Height="24"
                           Foreground="{StaticResource CraftPrimaryLightBrush}" />
          <TextBlock Text="{loc:Translate GuildInviteTitle}"
                     FontSize="18" FontWeight="Bold"
                     Foreground="{StaticResource CraftPrimaryLightBrush}"
                     VerticalAlignment="Center" />
        </StackPanel>
      </Grid>
    </Border>

    <!-- ================================================================= -->
    <!-- CONTENT                                                           -->
    <!-- ================================================================= -->
    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
      <StackPanel Spacing="16" Margin="16,12,16,80">

        <!-- Einladungs-Code Sektion -->
        <Border Classes="Card StatsCard">
          <StackPanel Spacing="10">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="KeyVariant" Width="20" Height="20"
                               Foreground="{StaticResource CraftGoldBrush}" />
              <TextBlock Text="{loc:Translate InviteCode}"
                         FontSize="15" FontWeight="Bold"
                         Foreground="{StaticResource CraftGoldBrush}" />
            </StackPanel>

            <!-- Aktueller Code -->
            <Border Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="10" Padding="16,12"
                    HorizontalAlignment="Center">
              <TextBlock Text="{Binding GuildInviteCode}"
                         FontSize="28" FontWeight="ExtraBold"
                         Foreground="{StaticResource CraftPrimaryLightBrush}"
                         LetterSpacing="6"
                         HorizontalAlignment="Center" />
            </Border>

            <!-- Code teilen -->
            <Button Classes="Primary" HorizontalAlignment="Center"
                    Command="{Binding ShareInviteCodeCommand}"
                    Padding="20,8">
              <StackPanel Orientation="Horizontal" Spacing="8">
                <mi:MaterialIcon Kind="ShareVariant" Width="18" Height="18" />
                <TextBlock Text="{loc:Translate ShareCode}"
                           FontSize="14" FontWeight="Bold" />
              </StackPanel>
            </Button>
          </StackPanel>
        </Border>

        <!-- Code eingeben Sektion -->
        <Border Classes="Card StatsCard">
          <StackPanel Spacing="10">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <mi:MaterialIcon Kind="KeyboardReturn" Width="20" Height="20"
                               Foreground="{StaticResource CraftPrimaryLightBrush}" />
              <TextBlock Text="{loc:Translate EnterCode}"
                         FontSize="15" FontWeight="Bold"
                         Foreground="{StaticResource CraftPrimaryLightBrush}" />
            </StackPanel>

            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
              <TextBox Grid.Column="0"
                       Text="{Binding JoinCodeInput}"
                       Watermark="ABC123"
                       MaxLength="6"
                       HorizontalAlignment="Stretch" />
              <Button Grid.Column="1" Classes="Primary" Padding="16,8"
                      Command="{Binding JoinByCodeCommand}">
                <TextBlock Text="{loc:Translate JoinByCode}"
                           FontSize="13" FontWeight="Bold" />
              </Button>
            </Grid>
          </StackPanel>
        </Border>

        <!-- Verfügbare Spieler -->
        <Border Classes="Card StatsCard">
          <StackPanel Spacing="10">
            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
              <mi:MaterialIcon Kind="AccountSearch" Width="20" Height="20"
                               Foreground="{StaticResource CraftPrimaryLightBrush}" />
              <TextBlock Grid.Column="1"
                         Text="{loc:Translate AvailablePlayers}"
                         FontSize="15" FontWeight="Bold"
                         Foreground="{StaticResource CraftPrimaryLightBrush}" />
              <Button Grid.Column="2" Classes="Text" Padding="4"
                      Command="{Binding LoadAvailablePlayersCommand}">
                <mi:MaterialIcon Kind="Refresh" Width="18" Height="18"
                                 Foreground="{StaticResource CraftPrimaryLightBrush}" />
              </Button>
            </Grid>

            <!-- Leere Liste -->
            <StackPanel Spacing="6" HorizontalAlignment="Center"
                        IsVisible="{Binding HasNoAvailablePlayers}"
                        Margin="0,8,0,0">
              <mi:MaterialIcon Kind="AccountOff" Width="32" Height="32"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               HorizontalAlignment="Center" />
              <TextBlock Text="{loc:Translate NoPlayersAvailable}"
                         FontSize="12"
                         Foreground="{DynamicResource TextSecondaryBrush}"
                         HorizontalAlignment="Center" />
            </StackPanel>

            <!-- Spieler-Liste -->
            <ItemsControl ItemsSource="{Binding AvailablePlayers}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="vm:AvailablePlayerDisplay">
                  <Border Background="{DynamicResource SurfaceBrush}"
                          CornerRadius="8" Padding="10,8" Margin="0,2">
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
                      <Border Width="36" Height="36" CornerRadius="18"
                              Background="{StaticResource CraftSecondaryBrush}"
                              VerticalAlignment="Center">
                        <mi:MaterialIcon Kind="Account" Width="20" Height="20"
                                         Foreground="White"
                                         HorizontalAlignment="Center" VerticalAlignment="Center" />
                      </Border>
                      <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="1">
                        <TextBlock Text="{Binding Name}"
                                   FontSize="13" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}" />
                        <StackPanel Orientation="Horizontal" Spacing="8">
                          <TextBlock Text="{Binding LevelDisplay}"
                                     FontSize="11"
                                     Foreground="{StaticResource CraftPrimaryLightBrush}" />
                          <TextBlock Text="{Binding LastActiveDisplay}"
                                     FontSize="11"
                                     Foreground="{DynamicResource TextSecondaryBrush}" />
                        </StackPanel>
                      </StackPanel>
                      <Button Grid.Column="2" Classes="Primary" Padding="10,6"
                              VerticalAlignment="Center"
                              IsEnabled="{Binding !IsInvited}"
                              Command="{Binding $parent[ItemsControl].((vm:GuildViewModel)DataContext).InvitePlayerCommand}"
                              CommandParameter="{Binding .}">
                        <TextBlock Text="{Binding InviteButtonText}"
                                   FontSize="12" FontWeight="Bold" />
                      </Button>
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </Border>

      </StackPanel>
    </ScrollViewer>

  </Grid>

</UserControl>
